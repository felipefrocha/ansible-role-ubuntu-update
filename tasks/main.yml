---
# tasks file for config_ubuntu
- name: Set a hostname
  hostname:
    name: "{{ hostname.name }}"
  when: hostname.enabled

- name: Register current User
  become: no
  shell: id -u -n
  register: current_user
  changed_when: False

- name: Current User
  debug:
    msg: "{{ current_user.stdout }}"

- name: Docker Requirements
  debug:
    msg: "{{ docker.requirements }}"
  when: docker.requirements is defined

- name: Add Docker requirements
  apt:
    name: "{{ item }}"
    state: present
    update_cache: yes
  loop: "{{ docker.requirements }}"
  when: docker.enabled

- block:
  - name: Install Python3
    apt:
      name: "{{ item }}"
      state: present
      update_cache: yes
    loop: "{{ python.requirements }}"
    when: python.requirements is defined


  - name: Update pip
    shell: pip3 install -U pip
    changed_when: False
  when: python.enabled


- name: ensure ntpd is at the latest version
  apt: 
    name: ntp
    state: latest
    update_cache: yes
  notify:
  - restart ntp

- name: Upgrade the OS (apt-get full-upgrade)
  apt:
    upgrade: full

- name: Set authorized key taken from file
  ansible.posix.authorized_key:
    user: "{{ current_user.stdout }}"
    state: present
    key: "{{ lookup('file', ssh_pubkey_path) }}"